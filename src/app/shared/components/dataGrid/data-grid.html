<div class="rounded-lg border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03] flex flex-col h-full">
  @if (title()) {
    <div class="px-6 py-4 border-b border-gray-100 dark:border-white/[0.05]">
      <h3 class="text-base font-semibold text-gray-800 dark:text-white/90">{{ title() }}</h3>
    </div>
  }
  
  <div class="overflow-auto flex-1 relative">
    <table class="min-w-full divide-y divide-gray-100 dark:divide-white/[0.05]">
      <thead class="bg-gray-50 dark:bg-white/[0.02] sticky top-0 z-10 shadow-sm">
        <tr>
          @for (col of columns(); track col.key) {
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-400 relative group bg-gray-50 dark:bg-[#1a1b1e]">
              <div class="flex items-center gap-2">
                <!-- Sortable Label -->
                @if (col.sortable !== false) {
                  <button (click)="toggleSort(col.key)" class="flex items-center gap-1 hover:text-gray-700 dark:hover:text-gray-200 focus:outline-none">
                    {{ col.label }}
                    
                    <!-- Sort Icons -->
                    <span class="flex flex-col">
                      @if (sortConfig()?.key === col.key) {
                        @if (sortConfig()?.direction === 'asc') {
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-3 h-3">
                            <path fill-rule="evenodd" d="M10 17a.75.75 0 01-.75-.75V5.612L5.29 9.77a.75.75 0 01-1.08-1.04l5.25-5.5a.75.75 0 011.08 0l5.25 5.5a.75.75 0 11-1.08 1.04l-3.96-4.158V16.25A.75.75 0 0110 17z" clip-rule="evenodd" />
                          </svg>
                        } @else {
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-3 h-3">
                            <path fill-rule="evenodd" d="M10 3a.75.75 0 01.75.75v10.638l3.96-4.158a.75.75 0 111.08 1.04l-5.25 5.5a.75.75 0 01-1.08 0l-5.25-5.5a.75.75 0 111.08-1.04l3.96 4.158V3.75A.75.75 0 0110 3z" clip-rule="evenodd" />
                          </svg>
                        }
                      } @else {
                        <!-- Neutral/Inactive Sort Icon -->
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-3 h-3 text-gray-300 opacity-0 group-hover:opacity-100 transition-opacity">
                          <path fill-rule="evenodd" d="M10 3a.75.75 0 01.75.75v10.638l3.96-4.158a.75.75 0 111.08 1.04l-5.25 5.5a.75.75 0 01-1.08 0l-5.25-5.5a.75.75 0 111.08-1.04l3.96 4.158V3.75A.75.75 0 0110 3z" clip-rule="evenodd" />
                        </svg>
                      }
                    </span>
                  </button>
                } @else {
                  <span class="text-gray-500 dark:text-gray-400 font-medium text-xs uppercase tracking-wider">
                    {{ col.label }}
                  </span>
                }

                <!-- Filter Trigger -->
                @if (col.filterable !== false) {
                  <button (click)="toggleFilter(col.key)" 
                          [class.text-blue-500]="filters()[col.key]"
                          [class.text-gray-400]="!filters()[col.key]"
                          class="p-1 hover:text-gray-600 dark:hover:text-gray-300 focus:outline-none rounded-full hover:bg-gray-100 dark:hover:bg-white/10 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
                      <path fill-rule="evenodd" d="M9 3.5a5.5 5.5 0 100 11 5.5 5.5 0 000-11zM2 9a7 7 0 1112.452 4.391l3.328 3.329a.75.75 0 11-1.06 1.06l-3.329-3.328A7 7 0 012 9z" clip-rule="evenodd" />
                    </svg>
                  </button>

                  <!-- Filter Popup -->
                  @if (activeFilterColumn() === col.key) {
                    <div class="absolute top-full left-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-md shadow-lg border border-gray-100 dark:border-gray-700 z-10 p-2">
                      <input 
                        #filterInput
                        type="text" 
                        [value]="filters()[col.key] || ''"
                        (input)="updateFilter(col.key, filterInput.value)"
                        placeholder="Filtrar..."
                        class="w-full px-2 py-1 text-sm border border-gray-200 dark:border-gray-600 rounded bg-gray-50 dark:bg-gray-900 text-gray-700 dark:text-gray-200 focus:outline-none focus:ring-1 focus:ring-blue-500"
                        autofocus
                      >
                    </div>
                    <!-- Backdrop to close filter -->
                    <div class="fixed inset-0 z-0" (click)="toggleFilter(col.key)"></div>
                  }
                }
              </div>
            </th>
          }
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-100 dark:divide-white/[0.05]">
        @for (row of paginatedData(); track $index) {
          <tr class="hover:bg-gray-50 dark:hover:bg-white/[0.02] transition-colors">
            @for (col of columns(); track col.key) {
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">
                @if (templates()[col.key]) {
                  <ng-container *ngTemplateOutlet="templates()[col.key]; context: { $implicit: row }"></ng-container>
                } @else {
                  {{ row[col.key] }}
                }
              </td>
            }
          </tr>
        }
        @if (processedData().length === 0) {
          <tr>
            <td [attr.colspan]="columns().length" class="px-6 py-8 text-center text-sm text-gray-500 dark:text-gray-400">
              Nenhum dado encontrado.
            </td>
          </tr>
        }
      </tbody>
    </table>
  </div>

  <!-- Pagination Footer -->
  <div class="px-6 py-4 border-t border-gray-100 dark:border-white/[0.05] flex items-center justify-between bg-gray-50/50 dark:bg-white/[0.01]">
    
    <!-- Page Size Selector -->
    <div class="flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400">
      <span>Itens por página:</span>
      <select 
        [value]="pageSize()" 
        (change)="setPageSize($any($event.target).value)"
        class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded px-2 py-1 focus:outline-none focus:ring-1 focus:ring-blue-500 cursor-pointer"
      >
        <option [value]="2">2</option>
        <option [value]="10">10</option>
        <option [value]="20">20</option>
        <option [value]="50">50</option>
        <option [value]="100">100</option>
        <option [value]="200">200</option>
      </select>
    </div>

    <!-- Pagination Controls -->
    <div class="flex items-center gap-4">
      <span class="text-sm text-gray-500 dark:text-gray-400">
        {{ (currentPage() - 1) * pageSize() + 1 }} - {{ Math.min(currentPage() * pageSize(), totalItems()) }} de {{ totalItems() }}
      </span>

      <div class="flex items-center gap-1">
        <!-- First Page -->
        <button 
          (click)="setPage(1)"
          [disabled]="currentPage() === 1"
          class="p-1 rounded hover:bg-gray-200 dark:hover:bg-white/10 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
          title="Primeira Página"
        >
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
            <path fill-rule="evenodd" d="M15.79 14.77a.75.75 0 01-1.06.02l-4.5-4.25a.75.75 0 010-1.08l4.5-4.25a.75.75 0 111.04 1.08L11.832 10l3.938 3.71a.75.75 0 01.02 1.06zm-6 0a.75.75 0 01-1.06.02l-4.5-4.25a.75.75 0 010-1.08l4.5-4.25a.75.75 0 111.04 1.08L5.832 10l3.938 3.71a.75.75 0 01.02 1.06z" clip-rule="evenodd" />
          </svg>
        </button>

        <button 
          (click)="setPage(currentPage() - 1)"
          [disabled]="currentPage() === 1"
          class="p-1 rounded hover:bg-gray-200 dark:hover:bg-white/10 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
          title="Página Anterior"
        >
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
            <path fill-rule="evenodd" d="M12.79 5.23a.75.75 0 01-.02 1.06L8.832 10l3.938 3.71a.75.75 0 11-1.04 1.08l-4.5-4.25a.75.75 0 010-1.08l4.5-4.25a.75.75 0 011.06.02z" clip-rule="evenodd" />
          </svg>
        </button>

        @for (page of pagesArray; track $index) {
          @if (page === '...') {
            <span class="px-2 text-gray-400">...</span>
          } @else {
            <button 
              (click)="setPage($any(page))"
              [class.bg-blue-500]="currentPage() === page"
              [class.text-white]="currentPage() === page"
              [class.hover:bg-gray-200]="currentPage() !== page"
              [class.dark:hover:bg-white/10]="currentPage() !== page"
              class="px-3 py-1 rounded text-sm transition-colors"
            >
              {{ page }}
            </button>
          }
        }

        <button 
          (click)="setPage(currentPage() + 1)"
          [disabled]="currentPage() === totalPages()"
          class="p-1 rounded hover:bg-gray-200 dark:hover:bg-white/10 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
          title="Próxima Página"
        >
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
            <path fill-rule="evenodd" d="M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z" clip-rule="evenodd" />
          </svg>
        </button>

        <!-- Last Page -->
        <button 
          (click)="setPage(totalPages())"
          [disabled]="currentPage() === totalPages()"
          class="p-1 rounded hover:bg-gray-200 dark:hover:bg-white/10 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
          title="Última Página"
        >
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
            <path fill-rule="evenodd" d="M4.21 5.23a.75.75 0 011.06-.02l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.04-1.08L8.168 10 4.23 6.29a.75.75 0 01-.02-1.06zm6 0a.75.75 0 011.06-.02l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.04-1.08L14.168 10l-3.938-3.71a.75.75 0 01-.02-1.06z" clip-rule="evenodd" />
          </svg>
        </button>
      </div>
    </div>
  </div>
</div>
